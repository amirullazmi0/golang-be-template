datasource db {
  provider = "postgresql"
}

// User model
model User {
  id                 String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email              String    @unique @db.VarChar(255)
  password           String    @db.VarChar(255)
  name               String    @db.VarChar(255)
  role               UserRole  @default(USER)
  refreshToken       String?   @map("refresh_token") @db.Text
  tokenExpiry        DateTime? @map("token_expiry")
  verificationToken  String?   @map("verification_token") @db.Text
  verificationExpiry DateTime? @map("verification_expiry")
  isActive           Boolean   @default(false) @map("is_active")
  createdAt          DateTime  @default(now()) @map("created_at")
  updatedAt          DateTime  @default(now()) @map("updated_at")
  deletedAt          DateTime? @map("deleted_at")
  createdBy          String?   @map("created_by") @db.Uuid
  updatedBy          String?   @map("updated_by") @db.Uuid
  deletedBy          String?   @map("deleted_by") @db.Uuid

  addresses Address[]

  @@map("users")
}

// Address model
model Address {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId        String    @map("user_id") @db.Uuid
  label         String    @db.VarChar(100) // Home, Office, etc
  recipientName String    @map("recipient_name") @db.VarChar(255)
  phone         String    @db.VarChar(20)
  province      String    @db.VarChar(100)
  city          String    @db.VarChar(100)
  district      String    @db.VarChar(100)
  subDistrict   String    @map("sub_district") @db.VarChar(100)
  postalCode    String    @map("postal_code") @db.VarChar(10)
  fullAddress   String    @map("full_address") @db.Text
  isPrimary     Boolean   @default(false) @map("is_primary")
  isActive      Boolean   @default(true) @map("is_active")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @default(now()) @map("updated_at")
  deletedAt     DateTime? @map("deleted_at")
  createdBy     String?   @map("created_by") @db.Uuid
  updatedBy     String?   @map("updated_by") @db.Uuid
  deletedBy     String?   @map("deleted_by") @db.Uuid

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, label, deletedAt, isActive])
  @@map("addresses")
}

enum UserRole {
  SUPERADMIN
  ADMIN
  USER
}
