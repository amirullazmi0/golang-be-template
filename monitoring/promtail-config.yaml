server:
     http_listen_port: 9080
     grpc_listen_port: 0

positions:
     filename: /tmp/positions.yaml

clients:
     - url: http://loki:3100/loki/api/v1/push

scrape_configs:
     # Scrape JSON logs from application
     - job_name: kratify-backend
       static_configs:
            - targets:
                   - localhost
              labels:
                   job: kratify-backend
                   env: development
                   __path__: /var/log/app/*.log

       pipeline_stages:
            # Parse JSON logs and extract ALL fields
            - json:
                   expressions:
                        timestamp: timestamp
                        level: level
                        message: message
                        caller: caller
                        query: query
                        args: args
                        duration: duration
                        operation: operation
                        rows_affected: rows_affected
                        method: method
                        path: path
                        status: status
                        latency: latency
                        latency_ms: latency_ms
                        ip: ip
                        user_agent: user_agent
                        response_size: response_size

            # Extract labels from JSON
            - labels:
                   level:
                   operation:

            # Set timestamp from log entry
            - timestamp:
                   source: timestamp
                   format: RFC3339Nano
